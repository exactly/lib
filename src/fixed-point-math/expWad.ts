export default function expWad(x: bigint): bigint {
  /* eslint-disable unicorn/numeric-separators-style */
  if (x <= -42139678854452767551n) return 0n;
  if (x >= 135305999368893231589n) throw new Error("EXP_OVERFLOW");

  x = (x << 78n) / 5n ** 18n;

  const k = ((x << 96n) / 54916777467707473351141471128n + 2n ** 95n) >> 96n;
  x -= k * 54916777467707473351141471128n;

  let y = x + 1346386616545796478920950773328n;
  y = ((y * x) >> 96n) + 57155421227552351082224309758442n;
  let p = y + x - 94201549194550492254356042504812n;
  p = ((p * y) >> 96n) + 28719021644029726153956944680412240n;
  p = p * x + (4385272521454847904659076985693276n << 96n);

  let q = x - 2855989394907223263936484059900n;
  q = ((q * x) >> 96n) + 50020603652535783019961831881945n;
  q = ((q * x) >> 96n) - 533845033583426703283633433725380n;
  q = ((q * x) >> 96n) + 3604857256930695427073651918091429n;
  q = ((q * x) >> 96n) - 14423608567350463180887372962807573n;
  q = ((q * x) >> 96n) + 26449188498355588339934803723976023n;

  const r = p / q;
  return (r * 3822833074963236453042738258902158003155416615667n) >> (195n - k);
  /* eslint-enable unicorn/numeric-separators-style */
}
